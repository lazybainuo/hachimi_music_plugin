# 哈基米音乐插件 (hachimi_music_plugin)

一个基于 NoneBot2 + OneBot V11 的QQ群本地音乐播放插件。

## 功能特性

- 🎵 显示歌单（随机30首）
- ▶️ 点歌播放（并计入排行榜）
- 🔎 搜索（支持ID、关键词、正则、拼音、首字母）
- 🔁 重新加载音乐文件
- 🧪 插件自检
- 🧭 帮助/指令列表
- 🕒 每日定时推送（可选，需安装 `nonebot_plugin_apscheduler`）
- 💾 播放次数与推送群组持久化（`data/`）

## 使用方法

### 指令列表

- `/哈基米帮助`：查看帮助/指令列表
- `/哈基米歌单`：随机展示30首可播放的音乐
- `/哈基米点歌 <序号>`：播放指定序号的音乐（并计入排行榜）
- `/来首哈基米`：随机播放一首音乐（别名：随机哈基米、给我来首哈基米）
- `/哈基米搜索 <关键词或正则或ID>`：搜索乐曲（最多返回10条）
- `/哈基米排行榜 [页码]`：查看排行榜（每页30条，默认第1页）
- `/重载哈基米歌单`：重新扫描音乐文件（管理员）
- `/开启哈基米推送`：开启每日定时推送（管理员）
- `/关闭哈基米推送`：关闭每日定时推送（管理员）
- `/测试哈基米`：插件自检

### 定时推送说明（可选）

- 安装并启用 `nonebot_plugin_apscheduler` 后，插件会在每天 8:00 / 12:00 / 18:00 / 21:00 向已开启的群推送一首随机音乐。
- 开启/关闭推送仅限 `SUPERUSER`、群主、群管理：
  - 开启：`/开启哈基米推送`
  - 关闭：`/关闭哈基米推送`
- 推送状态对群组进行持久化，文件位于 `plugins/hachimi_music_plugin/data/push_groups.json`。

## 安装与配置

1. 将音乐文件放入 `plugins/hachimi_music_plugin/music_data/` 文件夹中。
2. 支持的音频格式：MP3/WAV/FLAC/M4A/OGG/AAC。
3. 文件名即展示标题，建议使用有意义的名称。
4. 如需定时推送，请安装并启用 `nonebot_plugin_apscheduler`。

## 示例

```
用户: /哈基米歌单
Bot: 🎵 哈基米歌单（随机30首）
0: 歌曲A
1: 歌曲B
...

用户: /哈基米点歌 16
Bot: 正在为您播放：
《某歌曲》
●━━━━━━─────── 4:15
[发送音频]
```

## 注意事项

- 默认音频大小限制为 10MB。
- 添加/删除音乐后可使用 `/重载哈基米歌单` 刷新歌单。
- 如未安装 `nonebot_plugin_apscheduler`，定时推送不可用。

## 技术实现

- NoneBot2 + OneBot V11
- 自动扫描文件系统获取音乐列表
- 文本归一化 + 拼音/首字母 + 相似度综合匹配搜索
- 播放计数与推送群组本地持久化 